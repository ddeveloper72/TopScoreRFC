<!-- Game History Component -->
<div class="game-history-container">

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>
                <i class="fa-solid fa-clock-rotate-left"></i>
                Game History
            </h1>
            <p>Review and manage your rugby match history</p>
        </div>
    </div>

    <!-- Statistics Overview -->
    <div class="stats-section">
        <div class="stats-grid">
            <mat-card class="stat-card">
                <mat-card-content>
                    <div class="stat-icon">
                        <app-rugby-ball-primary size="32"></app-rugby-ball-primary>
                    </div>
                    <div class="stat-number">{{ statistics.totalGames || 0 }}</div>
                    <div class="stat-label">Total Games</div>
                </mat-card-content>
            </mat-card>

            <mat-card class="stat-card">
                <mat-card-content>
                    <div class="stat-icon">
                        <mat-icon color="accent">check_circle</mat-icon>
                    </div>
                    <div class="stat-number">{{ statistics.completedGames || 0 }}</div>
                    <div class="stat-label">Completed</div>
                </mat-card-content>
            </mat-card>

            <mat-card class="stat-card">
                <mat-card-content>
                    <div class="stat-icon">
                        <mat-icon color="warn">schedule</mat-icon>
                    </div>
                    <div class="stat-number">{{ statistics.activeGames || 0 }}</div>
                    <div class="stat-label">Active Games</div>
                </mat-card-content>
            </mat-card>

            <mat-card class="stat-card">
                <mat-card-content>
                    <div class="stat-icon">
                        <mat-icon>trending_up</mat-icon>
                    </div>
                    <div class="stat-number">{{ statistics.averageScore?.home || 0 }}</div>
                    <div class="stat-label">Avg Score</div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>

    <!-- Filter and Search Controls -->
    <div class="controls-section">
        <mat-card class="controls-card">
            <mat-card-content>
                <div class="controls-grid">

                    <!-- Search -->
                    <mat-form-field class="search-field" appearance="outline">
                        <mat-label>Search teams</mat-label>
                        <input matInput [(ngModel)]="filter.search" (input)="onFilterChange()"
                            placeholder="Enter team name...">
                        <mat-icon matSuffix *ngIf="!filter.search">search</mat-icon>
                        <button mat-icon-button matSuffix *ngIf="filter.search" (click)="clearSearch()">
                            <mat-icon>clear</mat-icon>
                        </button>
                    </mat-form-field>

                    <!-- Status Filter -->
                    <mat-form-field appearance="outline">
                        <mat-label>Status</mat-label>
                        <mat-select [(ngModel)]="filter.status" (selectionChange)="onFilterChange()">
                            <mat-option value="all">All Matches</mat-option>
                            <mat-option value="completed">Completed</mat-option>
                            <mat-option value="scheduled">Scheduled</mat-option>
                            <mat-option value="cancelled">Cancelled</mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- Sort By -->
                    <mat-form-field appearance="outline">
                        <mat-label>Sort by</mat-label>
                        <mat-select [(ngModel)]="filter.sortBy" (selectionChange)="onFilterChange()">
                            <mat-option value="date">Date</mat-option>
                            <mat-option value="teams">Teams</mat-option>
                            <mat-option value="venue">Venue</mat-option>
                            <mat-option value="score">Total Score</mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- Sort Order -->
                    <mat-form-field appearance="outline">
                        <mat-label>Order</mat-label>
                        <mat-select [(ngModel)]="filter.sortOrder" (selectionChange)="onFilterChange()">
                            <mat-option value="desc">Newest First</mat-option>
                            <mat-option value="asc">Oldest First</mat-option>
                        </mat-select>
                    </mat-form-field>

                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button mat-raised-button color="primary" (click)="exportAllMatches()"
                        [disabled]="matches.length === 0">
                        <mat-icon>download</mat-icon>
                        Export All
                    </button>
                    <button mat-raised-button color="warn" (click)="clearAllMatches()"
                        [disabled]="matches.length === 0">
                        <mat-icon>delete_sweep</mat-icon>
                        Clear All
                    </button>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Matches List -->
    <div class="matches-section">

        <!-- No Matches Message -->
        <div class="no-matches" *ngIf="filteredMatches.length === 0 && matches.length === 0">
            <mat-card class="no-matches-card">
                <mat-card-content>
                    <div class="no-matches-content">
                        <app-rugby-ball-gray size="64" class="no-matches-icon"></app-rugby-ball-gray>
                        <h3>No Matches Yet</h3>
                        <p>Schedule some rugby matches to see your match history here!</p>
                        <button mat-raised-button color="primary" routerLink="/calendar">
                            <mat-icon>event</mat-icon>
                            Schedule Match
                        </button>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>

        <!-- No Results Message -->
        <div class="no-results" *ngIf="filteredMatches.length === 0 && matches.length > 0">
            <mat-card class="no-results-card">
                <mat-card-content>
                    <div class="no-results-content">
                        <mat-icon class="no-results-icon">search_off</mat-icon>
                        <h3>No Matches Found</h3>
                        <p>Try adjusting your search or filter criteria.</p>
                        <button mat-stroked-button (click)="clearSearch()">
                            <mat-icon>clear_all</mat-icon>
                            Clear Filters
                        </button>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>

        <!-- Enhanced Match Cards Grid -->
        <div class="matches-grid" *ngIf="filteredMatches.length > 0">
            <mat-card class="enhanced-match-card" *ngFor="let match of filteredMatches"
                (click)="openMatchDetails(match)">

                <!-- Card Header with Date and Status -->
                <mat-card-header class="match-header">
                    <div class="match-date-section">
                        <div class="match-date">
                            <mat-icon>event</mat-icon>
                            <span>{{ formatDate(match.date) }}</span>
                        </div>
                        <div class="match-time">
                            {{ formatTime(match.date) }}
                        </div>
                    </div>

                    <div class="match-status-section">
                        <mat-chip [color]="getStatusColor(match.status)" selected>
                            <mat-icon>{{ getStatusIcon(match.status) }}</mat-icon>
                            {{ match.status | titlecase }}
                        </mat-chip>
                    </div>
                </mat-card-header>

                <mat-card-content class="match-content">

                    <!-- Teams and Score Display -->
                    <div class="teams-display">
                        <div class="team home-team">
                            <div class="team-info">
                                <h3 class="team-name">{{ match.homeTeam }}</h3>
                                <div class="team-details" *ngIf="match.homeTeamCategory && match.homeTeamAgeLevel">
                                    <span class="team-category">{{ formatTeamCategory(match.homeTeamCategory) }}</span>
                                    <span class="team-age">{{ match.homeTeamAgeLevel }}</span>
                                </div>
                                <span class="team-label">Home</span>
                            </div>
                            <div class="team-score" *ngIf="match.status === 'completed'">
                                {{ match.homeScore || 0 }}
                            </div>
                        </div>

                        <div class="vs-section">
                            <app-rugby-ball-accent size="32" [rotation]="15" class="vs-icon"></app-rugby-ball-accent>
                            <div class="vs-text">VS</div>
                        </div>

                        <div class="team away-team">
                            <div class="team-info">
                                <h3 class="team-name">{{ match.awayTeam }}</h3>
                                <div class="team-details" *ngIf="match.awayTeamAgeLevel">
                                    <span class="team-age">{{ match.awayTeamAgeLevel }}</span>
                                </div>
                                <span class="team-label">Away</span>
                            </div>
                            <div class="team-score" *ngIf="match.status === 'completed'">
                                {{ match.awayScore || 0 }}
                            </div>
                        </div>
                    </div>

                    <!-- Match Details Info -->
                    <div class="match-info">

                        <!-- Match Type Information -->
                        <div class="info-row match-type-info" *ngIf="match.matchType">
                            <mat-icon
                                [style.color]="match.matchType === 'girls' ? '#e91e63' : match.matchType === 'boys' ? '#2196f3' : '#4caf50'">
                                {{ match.matchType === 'girls' ? 'female' : match.matchType === 'boys' ? 'male' :
                                'groups' }}
                            </mat-icon>
                            <span class="match-type-label">{{ formatMatchType(match.matchType) }}</span>
                        </div>

                        <!-- Venue Information -->
                        <div class="info-row venue-info">
                            <mat-icon>location_on</mat-icon>
                            <div class="venue-details">
                                <span class="venue-name">{{ match.venue }}</span>
                                <span class="venue-address" *ngIf="match.venueDetails?.formattedAddress">
                                    {{ match.venueDetails?.formattedAddress }}
                                </span>
                            </div>
                        </div>

                        <!-- Competition Information -->
                        <div class="info-row competition-info" *ngIf="match.competition">
                            <mat-icon
                                [style.color]="getMatchTypeColor(match.competition) === 'warn' ? '#ff9800' : '#1976d2'">
                                emoji_events
                            </mat-icon>
                            <span class="competition-name">{{ match.competition }}</span>
                        </div>

                        <!-- Result Information (for completed matches) -->
                        <div class="info-row result-info" *ngIf="match.status === 'completed'">
                            <mat-icon [style.color]="getWinner(match) === 'Draw' ? '#ff9800' : '#4caf50'">
                                {{ getWinner(match) === 'Draw' ? 'balance' : 'emoji_events' }}
                            </mat-icon>
                            <span class="result-text">
                                <ng-container *ngIf="getWinner(match) === 'Draw'">
                                    Match ended in a draw ({{ getTotalScore(match) }} total points)
                                </ng-container>
                                <ng-container *ngIf="getWinner(match) !== 'Draw' && getWinner(match) !== 'TBD'">
                                    {{ getWinner(match) }} won by {{ getScoreDifference(match) }} points
                                </ng-container>
                            </span>
                        </div>

                    </div>

                    <!-- Interactive Elements Indicators -->
                    <div class="interaction-indicators" *ngIf="match.status === 'completed'">
                        <mat-chip-set class="indicator-chips">
                            <mat-chip class="indicator-chip" *ngIf="hasNotes(match.id)" color="primary" selected>
                                <mat-icon>note</mat-icon>
                                Notes
                            </mat-chip>
                            <mat-chip class="indicator-chip" *ngIf="hasPhotos(match.id)" color="accent" selected>
                                <mat-icon>photo_library</mat-icon>
                                Photos
                            </mat-chip>
                            <mat-chip class="indicator-chip view-details" color="primary" selected>
                                <mat-icon>visibility</mat-icon>
                                View Details
                            </mat-chip>
                        </mat-chip-set>
                    </div>

                </mat-card-content>

                <!-- Card Actions -->
                <mat-card-actions class="match-actions">
                    <div class="action-buttons-left">
                        <button mat-icon-button [matTooltip]="'View match details'"
                            (click)="openMatchDetails(match); $event.stopPropagation()">
                            <mat-icon>open_in_new</mat-icon>
                        </button>

                        <button mat-icon-button [matTooltip]="'Export match data'"
                            (click)="exportMatch(match); $event.stopPropagation()">
                            <mat-icon>download</mat-icon>
                        </button>
                    </div>

                    <div class="action-buttons-right">
                        <button mat-icon-button [matMenuTriggerFor]="matchMenu" [matTooltip]="'More options'"
                            (click)="$event.stopPropagation()">
                            <mat-icon>more_vert</mat-icon>
                        </button>

                        <mat-menu #matchMenu="matMenu">
                            <button mat-menu-item (click)="openMatchDetails(match)">
                                <mat-icon>visibility</mat-icon>
                                <span>View Details</span>
                            </button>
                            <button mat-menu-item (click)="exportMatch(match)">
                                <mat-icon>download</mat-icon>
                                <span>Export Match</span>
                            </button>
                            <button mat-menu-item (click)="deleteMatch(match.id)" class="danger-action">
                                <mat-icon>delete</mat-icon>
                                <span>Delete Match</span>
                            </button>
                        </mat-menu>
                    </div>
                </mat-card-actions>

                <!-- Hover Effect Overlay -->
                <div class="card-hover-overlay"></div>

            </mat-card>
        </div>
    </div>

</div>