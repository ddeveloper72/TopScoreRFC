<!-- Rugby Match Calendar -->
<div class="calendar-container">
  <div class="calendar-header">
    <h1><i class="fa-solid fa-calendar-days"></i> Match Calendar</h1>
    <button mat-raised-button color="primary" (click)="addNewMatch()">
      <i class="fa-solid fa-plus"></i>
      Schedule Match
    </button>
  </div>

  <!-- Quick Date Navigation -->
  <div class="date-navigation">
    <button mat-icon-button (click)="previousMonth()">
      <i class="fa-solid fa-chevron-left"></i>
    </button>
    <h2>{{ currentMonth | date:'MMMM yyyy' }}</h2>
    <button mat-icon-button (click)="nextMonth()">
      <i class="fa-solid fa-chevron-right"></i>
    </button>
  </div>

  <!-- Calendar View Options -->
  <div class="view-options">
    <mat-button-toggle-group [(value)]="currentView">
      <mat-button-toggle value="month">Month</mat-button-toggle>
      <mat-button-toggle value="list">List</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- Calendar Grid (Month View) -->
  <div class="calendar-grid" *ngIf="currentView === 'month'" [@fadeInOut]>

    <!-- Week Days Header -->
    <div class="calendar-header-row">
      <div class="day-header" *ngFor="let day of weekDays">{{ day }}</div>
    </div>

    <!-- Calendar Days -->
    <div class="calendar-body">
      <div class="calendar-day" *ngFor="let day of calendarDays; let i = index" [ngClass]="{
          'other-month': !day.isCurrentMonth,
          'today': day.isToday,
          'has-matches': day.hasMatches
        }" (click)="onDayClick(day)" [@fadeInOut] [style.animation-delay]="(i * 20) + 'ms'">

        <div class="day-number">{{ day.day }}</div>

        <!-- Match indicators for this day -->
        <div class="match-indicators" *ngIf="day.hasMatches">
          <div class="match-dot" *ngFor="let match of day.matches.slice(0, 3)" [ngClass]="getMatchTimingClass(match)"
            [matTooltip]="getMatchTooltip(match)" matTooltipPosition="above" (click)="openMatchDetails(match, $event)">
          </div>
          <div class="more-matches" *ngIf="day.matches.length > 3"
            [matTooltip]="'View all ' + day.matches.length + ' matches'" matTooltipPosition="above">
            +{{ day.matches.length - 3 }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- List View -->
  <div class="matches-list" *ngIf="currentView === 'list'" [@fadeInOut]>
    <h3 [@slideInFromBottom]>Upcoming Matches</h3>

    <!-- Match Cards with Split Structure -->
    <div class="match-card" *ngFor="let match of upcomingMatches; let i = index" [@fadeInOut]
      [style.animation-delay]="(i * 100) + 'ms'">

      <!-- Top Section - Always Visible -->
      <div class="match-top-section">
        <!-- Teams and Score -->
        <div class="match-teams-header">
          <div class="team home-team">
            <span class="team-name">{{ match.homeTeam }}</span>
            <div class="team-score" *ngIf="match.homeScore !== undefined">{{ match.homeScore }}</div>
          </div>

          <div class="score-separator">
            <span class="vs-text">-</span>
          </div>

          <div class="team away-team">
            <span class="team-name">{{ match.awayTeam }}</span>
            <div class="team-score" *ngIf="match.awayScore !== undefined">{{ match.awayScore }}</div>
          </div>
        </div>

        <!-- Match Type and Status -->
        <div class="match-info-row">
          <div class="match-type-info" *ngIf="match.homeTeamCategory">
            <i class="fa-solid fa-users"></i>
            <span>{{ formatTeamCategory(match.homeTeamCategory) }}</span>
          </div>
          <div class="match-status-info">
            <i class="fa-solid fa-trophy"></i>
            <span>{{ match.matchType || 'Friendly Match' }}</span>
          </div>
        </div>

        <!-- Date and Actions -->
        <div class="match-date-actions">
          <div class="match-date">
            {{ match.date | date:'EEEE, MMM dd, yyyy' }}
          </div>
          <button mat-button (click)="editMatch(match)" class="match-edit-btn">
            <i class="fa-solid fa-pen"></i>
            Edit
          </button>
        </div>
      </div>

      <!-- Bottom Section - Accordion for Match Events -->
      <mat-accordion class="match-events-accordion">
        <mat-expansion-panel [expanded]="isAccordionExpanded(match._id || match.id)"
          (opened)="onAccordionOpened(match._id || match.id)" (closed)="onAccordionClosed(match._id || match.id)"
          class="match-events-panel">

          <mat-expansion-panel-header class="events-header">
            <mat-panel-title>
              <i class="fa-solid fa-list"></i>
              <span>Match Events (9)</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <!-- Match Events Content -->
          <div class="match-events-content">
            <!-- Sample match events - replace with actual match events data -->
            <div class="match-event">
              <div class="event-time">1:52</div>
              <div class="event-icon try-icon">
                <i class="fa-solid fa-football"></i>
              </div>
              <div class="event-details">
                <div class="event-type">Try</div>
                <div class="event-description">Try by {{ match.homeTeam }}</div>
                <div class="event-team">{{ match.homeTeam }}</div>
              </div>
            </div>

            <div class="match-event">
              <div class="event-time">1:50</div>
              <div class="event-icon conversion-icon">
                <i class="fa-solid fa-target"></i>
              </div>
              <div class="event-details">
                <div class="event-type">Conversion</div>
                <div class="event-description">Conversion by {{ match.homeTeam }}</div>
                <div class="event-team">{{ match.homeTeam }}</div>
              </div>
            </div>

            <div class="match-event">
              <div class="event-time">1:48</div>
              <div class="event-icon try-icon">
                <i class="fa-solid fa-football"></i>
              </div>
              <div class="event-details">
                <div class="event-type">Try</div>
                <div class="event-description">Try by {{ match.homeTeam }}</div>
                <div class="event-team">{{ match.homeTeam }}</div>
              </div>
            </div>

            <div class="match-event">
              <div class="event-time">1:34</div>
              <div class="event-icon drop-goal-icon">
                <i class="fa-solid fa-bullseye"></i>
              </div>
              <div class="event-details">
                <div class="event-type">Drop Goal</div>
                <div class="event-description">Drop Goal by {{ match.homeTeam }}</div>
                <div class="event-team">{{ match.homeTeam }}</div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>

    <!-- No matches message -->
    <div class="no-matches" *ngIf="upcomingMatches.length === 0">
      <i class="fa-solid fa-calendar-xmark"></i>
      <h3>No upcoming matches</h3>
      <p>Schedule your first match to get started</p>
      <button mat-raised-button color="primary" (click)="addNewMatch()">
        <i class="fa-solid fa-plus"></i>
        Schedule Match
      </button>
    </div>
  </div>
</div>